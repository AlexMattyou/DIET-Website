<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

  <h2>Login Form</h2>
  <form id="loginForm">
    <label for="username">Username:</label><br>
    <input type="text" id="username" name="username" required><br><br>
    <label for="password">Password:</label><br>
    <input type="password" id="password" name="password" required><br><br>
    <button type="submit">Login</button>
  </form>

  <script type="module">
    // Set cookie
    function setCookie(name, value, days) {
      let date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      const expires = "expires=" + date.toUTCString();
      document.cookie = name + "=" + value + ";" + expires + ";path=/;domain=" + window.location.hostname;
    }

    $(document).ready(function () {
      $('#loginForm').on('submit', function (e) {
        e.preventDefault();

        const username = $('#username').val();
        const password = $('#password').val();

        $.ajax({
          url: 'http://127.0.0.1:5879/diet-admin/login',  // Your API endpoint
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({ username, password }),
          success: function (data) {
            if (data.token) {
              setCookie('Authorization', `Bearer ${data.token}`, 1);  // Store token in cookies for 1 day
              alert('Login successful!');
              window.location.href = 'http://127.0.0.1:5500/Frontend/admin-zone/index.html';
              console.log(data.token)
            } else {
              alert('Login failed');
            }
          },
          error: function () {
            alert('Invalid credentials');
          }
        });
      });
    });
  </script>

</body>
</html>
